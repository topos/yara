package co.topos.util

object Html {
  def encode(str: String) = {
    import org.apache.commons.lang.StringUtils._
    val b = new StringBuilder
    str.foreach{c => if (c <= 127) b.append(c) else b.append("&#x%x;".format(c.toInt))}
    val xml = replaceEach(b.toString, ENTITY_MAP.keys.toArray, ENTITY_MAP.values.toArray)
    xml.replaceAll("([A-Za-z]+)(&)([A-Za-z]+[^;])", "$1&#x0026;$3").replaceAll(" & ", " &#x0026; ")
  }
  
  import scala.collection.mutable.HashMap
  val ENTITY_MAP = new HashMap[String, String]
  ENTITY_MAP += "&quot;" -> "&#x0022;"
  ENTITY_MAP += "&amp;" -> "&#x0026;"
  ENTITY_MAP += "&apos;" -> "&#x0027;"
  ENTITY_MAP += "&lt;" -> "&#x003c;"
  ENTITY_MAP += "&gt;" -> "&#x003e;"
  ENTITY_MAP += "&nbsp;" -> "&#x00a0;"
  ENTITY_MAP += "&iexcl;" -> "&#x00a1;"
  ENTITY_MAP += "&cent;" -> "&#x00a2;"
  ENTITY_MAP += "&pound;" -> "&#x00a3;"
  ENTITY_MAP += "&curren;" -> "&#x00a4;"
  ENTITY_MAP += "&yen;" -> "&#x00a5;"
  ENTITY_MAP += "&brvbar;" -> "&#x00a6;"
  ENTITY_MAP += "&sect;" -> "&#x00a7;"
  ENTITY_MAP += "&uml;" -> "&#x00a8;"
  ENTITY_MAP += "&copy;" -> "&#x00a9;"
  ENTITY_MAP += "&ordf;" -> "&#x00aa;"
  ENTITY_MAP += "&laquo;" -> "&#x00ab;"
  ENTITY_MAP += "&not;" -> "&#x00ac;"
  ENTITY_MAP += "&shy;" -> "&#x00ad;"
  ENTITY_MAP += "&reg;" -> "&#x00ae;"
  ENTITY_MAP += "&macr;" -> "&#x00af;"
  ENTITY_MAP += "&deg;" -> "&#x00b0;"
  ENTITY_MAP += "&plusmn;" -> "&#x00b1;"
  ENTITY_MAP += "&sup2;" -> "&#x00b2;"
  ENTITY_MAP += "&sup3;" -> "&#x00b3;"
  ENTITY_MAP += "&acute;" -> "&#x00b4;"
  ENTITY_MAP += "&micro;" -> "&#x00b5;"
  ENTITY_MAP += "&para;" -> "&#x00b6;"
  ENTITY_MAP += "&middot;" -> "&#x00b7;"
  ENTITY_MAP += "&cedil;" -> "&#x00b8;"
  ENTITY_MAP += "&sup1;" -> "&#x00b9;"
  ENTITY_MAP += "&ordm;" -> "&#x00ba;"
  ENTITY_MAP += "&raquo;" -> "&#x00bb;"
  ENTITY_MAP += "&frac14;" -> "&#x00bc;"
  ENTITY_MAP += "&frac12;" -> "&#x00bd;"
  ENTITY_MAP += "&frac34;" -> "&#x00be;"
  ENTITY_MAP += "&iquest;" -> "&#x00bf;"
  ENTITY_MAP += "&Agrave;" -> "&#x00c0;"
  ENTITY_MAP += "&Aacute;" -> "&#x00c1;"
  ENTITY_MAP += "&Acirc;" -> "&#x00c2;"
  ENTITY_MAP += "&Atilde;" -> "&#x00c3;"
  ENTITY_MAP += "&Auml;" -> "&#x00c4;"
  ENTITY_MAP += "&Aring;" -> "&#x00c5;"
  ENTITY_MAP += "&AElig;" -> "&#x00c6;"
  ENTITY_MAP += "&Ccedil;" -> "&#x00c7;"
  ENTITY_MAP += "&Egrave;" -> "&#x00c8;"
  ENTITY_MAP += "&Eacute;" -> "&#x00c9;"
  ENTITY_MAP += "&Ecirc;" -> "&#x00ca;"
  ENTITY_MAP += "&Euml;" -> "&#x00cb;"
  ENTITY_MAP += "&Igrave;" -> "&#x00cc;"
  ENTITY_MAP += "&Iacute;" -> "&#x00cd;"
  ENTITY_MAP += "&Icirc;" -> "&#x00ce;"
  ENTITY_MAP += "&Iuml;" -> "&#x00cf;"
  ENTITY_MAP += "&ETH;" -> "&#x00d0;"
  ENTITY_MAP += "&Ntilde;" -> "&#x00d1;"
  ENTITY_MAP += "&Ograve;" -> "&#x00d2;"
  ENTITY_MAP += "&Oacute;" -> "&#x00d3;"
  ENTITY_MAP += "&Ocirc;" -> "&#x00d4;"
  ENTITY_MAP += "&Otilde;" -> "&#x00d5;"
  ENTITY_MAP += "&Ouml;" -> "&#x00d6;"
  ENTITY_MAP += "&times;" -> "&#x00d7;"
  ENTITY_MAP += "&Oslash;" -> "&#x00d8;"
  ENTITY_MAP += "&Ugrave;" -> "&#x00d9;"
  ENTITY_MAP += "&Uacute;" -> "&#x00da;"
  ENTITY_MAP += "&Ucirc;" -> "&#x00db;"
  ENTITY_MAP += "&Uuml;" -> "&#x00dc;"
  ENTITY_MAP += "&Yacute;" -> "&#x00dd;"
  ENTITY_MAP += "&THORN;" -> "&#x00de;"
  ENTITY_MAP += "&szlig;" -> "&#x00df;"
  ENTITY_MAP += "&agrave;" -> "&#x00e0;"
  ENTITY_MAP += "&aacute;" -> "&#x00e1;"
  ENTITY_MAP += "&acirc;" -> "&#x00e2;"
  ENTITY_MAP += "&atilde;" -> "&#x00e3;"
  ENTITY_MAP += "&auml;" -> "&#x00e4;"
  ENTITY_MAP += "&aring;" -> "&#x00e5;"
  ENTITY_MAP += "&aelig;" -> "&#x00e6;"
  ENTITY_MAP += "&ccedil;" -> "&#x00e7;"
  ENTITY_MAP += "&egrave;" -> "&#x00e8;"
  ENTITY_MAP += "&eacute;" -> "&#x00e9;"
  ENTITY_MAP += "&ecirc;" -> "&#x00ea;"
  ENTITY_MAP += "&euml;" -> "&#x00eb;"
  ENTITY_MAP += "&igrave;" -> "&#x00ec;"
  ENTITY_MAP += "&iacute;" -> "&#x00ed;"
  ENTITY_MAP += "&icirc;" -> "&#x00ee;"
  ENTITY_MAP += "&iuml;" -> "&#x00ef;"
  ENTITY_MAP += "&eth;" -> "&#x00f0;"
  ENTITY_MAP += "&ntilde;" -> "&#x00f1;"
  ENTITY_MAP += "&ograve;" -> "&#x00f2;"
  ENTITY_MAP += "&oacute;" -> "&#x00f3;"
  ENTITY_MAP += "&ocirc;" -> "&#x00f4;"
  ENTITY_MAP += "&otilde;" -> "&#x00f5;"
  ENTITY_MAP += "&ouml;" -> "&#x00f6;"
  ENTITY_MAP += "&divide;" -> "&#x00f7;"
  ENTITY_MAP += "&oslash;" -> "&#x00f8;"
  ENTITY_MAP += "&ugrave;" -> "&#x00f9;"
  ENTITY_MAP += "&uacute;" -> "&#x00fa;"
  ENTITY_MAP += "&ucirc;" -> "&#x00fb;"
  ENTITY_MAP += "&uuml;" -> "&#x00fc;"
  ENTITY_MAP += "&yacute;" -> "&#x00fd;"
  ENTITY_MAP += "&thorn;" -> "&#x00fe;"
  ENTITY_MAP += "&yuml;" -> "&#x00ff;"
  ENTITY_MAP += "&OElig;" -> "&#x0152;"
  ENTITY_MAP += "&oelig;" -> "&#x0153;"
  ENTITY_MAP += "&Scaron;" -> "&#x0160;"
  ENTITY_MAP += "&scaron;" -> "&#x0161;"
  ENTITY_MAP += "&Yuml;" -> "&#x0178;"
  ENTITY_MAP += "&fnof;" -> "&#x0192;"
  ENTITY_MAP += "&circ;" -> "&#x02c6;"
  ENTITY_MAP += "&tilde;" -> "&#x02dc;"
  ENTITY_MAP += "&Alpha;" -> "&#x0391;"
  ENTITY_MAP += "&Beta;" -> "&#x0392;"
  ENTITY_MAP += "&Gamma;" -> "&#x0393;"
  ENTITY_MAP += "&Delta;" -> "&#x0394;"
  ENTITY_MAP += "&Epsilon;" -> "&#x0395;"
  ENTITY_MAP += "&Zeta;" -> "&#x0396;"
  ENTITY_MAP += "&Eta;" -> "&#x0397;"
  ENTITY_MAP += "&Theta;" -> "&#x0398;"
  ENTITY_MAP += "&Iota;" -> "&#x0399;"
  ENTITY_MAP += "&Kappa;" -> "&#x039a;"
  ENTITY_MAP += "&Lambda;" -> "&#x039b;"
  ENTITY_MAP += "&Mu;" -> "&#x039c;"
  ENTITY_MAP += "&Nu;" -> "&#x039d;"
  ENTITY_MAP += "&Xi;" -> "&#x039e;"
  ENTITY_MAP += "&Omicron;" -> "&#x039f;"
  ENTITY_MAP += "&Pi;" -> "&#x03a0;"
  ENTITY_MAP += "&Rho;" -> "&#x03a1;"
  ENTITY_MAP += "&Sigma;" -> "&#x03a3;"
  ENTITY_MAP += "&Tau;" -> "&#x03a4;"
  ENTITY_MAP += "&Upsilon;" -> "&#x03a5;"
  ENTITY_MAP += "&Phi;" -> "&#x03a6;"
  ENTITY_MAP += "&Chi;" -> "&#x03a7;"
  ENTITY_MAP += "&Psi;" -> "&#x03a8;"
  ENTITY_MAP += "&Omega;" -> "&#x03a9;"
  ENTITY_MAP += "&alpha;" -> "&#x03b1;"
  ENTITY_MAP += "&beta;" -> "&#x03b2;"
  ENTITY_MAP += "&gamma;" -> "&#x03b3;"
  ENTITY_MAP += "&delta;" -> "&#x03b4;"
  ENTITY_MAP += "&epsilon;" -> "&#x03b5;"
  ENTITY_MAP += "&zeta;" -> "&#x03b6;"
  ENTITY_MAP += "&eta;" -> "&#x03b7;"
  ENTITY_MAP += "&theta;" -> "&#x03b8;"
  ENTITY_MAP += "&iota;" -> "&#x03b9;"
  ENTITY_MAP += "&kappa;" -> "&#x03ba;"
  ENTITY_MAP += "&lambda;" -> "&#x03bb;"
  ENTITY_MAP += "&mu;" -> "&#x03bc;"
  ENTITY_MAP += "&nu;" -> "&#x03bd;"
  ENTITY_MAP += "&xi;" -> "&#x03be;"
  ENTITY_MAP += "&omicron;" -> "&#x03bf;"
  ENTITY_MAP += "&pi;" -> "&#x03c0;"
  ENTITY_MAP += "&rho;" -> "&#x03c1;"
  ENTITY_MAP += "&sigmaf;" -> "&#x03c2;"
  ENTITY_MAP += "&sigma;" -> "&#x03c3;"
  ENTITY_MAP += "&tau;" -> "&#x03c4;"
  ENTITY_MAP += "&upsilon;" -> "&#x03c5;"
  ENTITY_MAP += "&phi;" -> "&#x03c6;"
  ENTITY_MAP += "&chi;" -> "&#x03c7;"
  ENTITY_MAP += "&psi;" -> "&#x03c8;"
  ENTITY_MAP += "&omega;" -> "&#x03c9;"
  ENTITY_MAP += "&thetasym;" -> "&#x03d1;"
  ENTITY_MAP += "&upsih;" -> "&#x03d2;"
  ENTITY_MAP += "&piv;" -> "&#x03d6;"
  ENTITY_MAP += "&ensp;" -> "&#x2002;"
  ENTITY_MAP += "&emsp;" -> "&#x2003;"
  ENTITY_MAP += "&thinsp;" -> "&#x2009;"
  ENTITY_MAP += "&zwnj;" -> "&#x200c;"
  ENTITY_MAP += "&zwj;" -> "&#x200d;"
  ENTITY_MAP += "&lrm;" -> "&#x200e;"
  ENTITY_MAP += "&rlm;" -> "&#x200f;"
  ENTITY_MAP += "&ndash;" -> "&#x2013;"
  ENTITY_MAP += "&mdash;" -> "&#x2014;"
  ENTITY_MAP += "&lsquo;" -> "&#x2018;"
  ENTITY_MAP += "&rsquo;" -> "&#x2019;"
  ENTITY_MAP += "&sbquo;" -> "&#x201a;"
  ENTITY_MAP += "&ldquo;" -> "&#x201c;"
  ENTITY_MAP += "&rdquo;" -> "&#x201d;"
  ENTITY_MAP += "&bdquo;" -> "&#x201e;"
  ENTITY_MAP += "&dagger;" -> "&#x2020;"
  ENTITY_MAP += "&Dagger;" -> "&#x2021;"
  ENTITY_MAP += "&bull;" -> "&#x2022;"
  ENTITY_MAP += "&hellip;" -> "&#x2026;"
  ENTITY_MAP += "&permil;" -> "&#x2030;"
  ENTITY_MAP += "&prime;" -> "&#x2032;"
  ENTITY_MAP += "&Prime;" -> "&#x2033;"
  ENTITY_MAP += "&lsaquo;" -> "&#x2039;"
  ENTITY_MAP += "&rsaquo;" -> "&#x203a;"
  ENTITY_MAP += "&oline;" -> "&#x203e;"
  ENTITY_MAP += "&frasl;" -> "&#x2044;"
  ENTITY_MAP += "&euro;" -> "&#x20ac;"
  ENTITY_MAP += "&image;" -> "&#x2111;"
  ENTITY_MAP += "&weierp;" -> "&#x2118;"
  ENTITY_MAP += "&real;" -> "&#x211c;"
  ENTITY_MAP += "&trade;" -> "&#x2122;"
  ENTITY_MAP += "&alefsym;" -> "&#x2135;"
  ENTITY_MAP += "&larr;" -> "&#x2190;"
  ENTITY_MAP += "&uarr;" -> "&#x2191;"
  ENTITY_MAP += "&rarr;" -> "&#x2192;"
  ENTITY_MAP += "&darr;" -> "&#x2193;"
  ENTITY_MAP += "&harr;" -> "&#x2194;"
  ENTITY_MAP += "&crarr;" -> "&#x21b5;"
  ENTITY_MAP += "&lArr;" -> "&#x21d0;"
  ENTITY_MAP += "&uArr;" -> "&#x21d1;"
  ENTITY_MAP += "&rArr;" -> "&#x21d2;"
  ENTITY_MAP += "&dArr;" -> "&#x21d3;"
  ENTITY_MAP += "&hArr;" -> "&#x21d4;"
  ENTITY_MAP += "&forall;" -> "&#x2200;"
  ENTITY_MAP += "&part;" -> "&#x2202;"
  ENTITY_MAP += "&exist;" -> "&#x2203;"
  ENTITY_MAP += "&empty;" -> "&#x2205;"
  ENTITY_MAP += "&nabla;" -> "&#x2207;"
  ENTITY_MAP += "&isin;" -> "&#x2208;"
  ENTITY_MAP += "&notin;" -> "&#x2209;"
  ENTITY_MAP += "&ni;" -> "&#x220b;"
  ENTITY_MAP += "&prod;" -> "&#x220f;"
  ENTITY_MAP += "&sum;" -> "&#x2211;"
  ENTITY_MAP += "&minus;" -> "&#x2212;"
  ENTITY_MAP += "&lowast;" -> "&#x2217;"
  ENTITY_MAP += "&radic;" -> "&#x221a;"
  ENTITY_MAP += "&prop;" -> "&#x221d;"
  ENTITY_MAP += "&infin;" -> "&#x221e;"
  ENTITY_MAP += "&ang;" -> "&#x2220;"
  ENTITY_MAP += "&and;" -> "&#x2227;"
  ENTITY_MAP += "&or;" -> "&#x2228;"
  ENTITY_MAP += "&cap;" -> "&#x2229;"
  ENTITY_MAP += "&cup;" -> "&#x222a;"
  ENTITY_MAP += "&int;" -> "&#x222b;"
  ENTITY_MAP += "&there4;" -> "&#x2234;"
  ENTITY_MAP += "&sim;" -> "&#x223c;"
  ENTITY_MAP += "&cong;" -> "&#x2245;"
  ENTITY_MAP += "&asymp;" -> "&#x2248;"
  ENTITY_MAP += "&ne;" -> "&#x2260;"
  ENTITY_MAP += "&equiv;" -> "&#x2261;"
  ENTITY_MAP += "&le;" -> "&#x2264;"
  ENTITY_MAP += "&ge;" -> "&#x2265;"
  ENTITY_MAP += "&sub;" -> "&#x2282;"
  ENTITY_MAP += "&sup;" -> "&#x2283;"
  ENTITY_MAP += "&nsub;" -> "&#x2284;"
  ENTITY_MAP += "&sube;" -> "&#x2286;"
  ENTITY_MAP += "&supe;" -> "&#x2287;"
  ENTITY_MAP += "&oplus;" -> "&#x2295;"
  ENTITY_MAP += "&otimes;" -> "&#x2297;"
  ENTITY_MAP += "&perp;" -> "&#x22a5;"
  ENTITY_MAP += "&sdot;" -> "&#x22c5;"
  ENTITY_MAP += "&lceil;" -> "&#x2308;"
  ENTITY_MAP += "&rceil;" -> "&#x2309;"
  ENTITY_MAP += "&lfloor;" -> "&#x230a;"
  ENTITY_MAP += "&rfloor;" -> "&#x230b;"
  ENTITY_MAP += "&lang;" -> "&#x2329;"
  ENTITY_MAP += "&rang;" -> "&#x232a;"
  ENTITY_MAP += "&loz;" -> "&#x25ca;"
  ENTITY_MAP += "&spades;" -> "&#x2660;"
  ENTITY_MAP += "&clubs;" -> "&#x2663;"
  ENTITY_MAP += "&hearts;" -> "&#x2665;"
  ENTITY_MAP += "&diams;" -> "&#x2666;"
}
